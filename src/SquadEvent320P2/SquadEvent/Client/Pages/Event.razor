@page "/Event/{eventId}"
@using System.Net
@using System.Security.Principal
@using System.Text.RegularExpressions
@using SquadEvent.Shared.Parameters
@inject HttpClient Client

    <AuthorizeView>
        <Authorized>
            <text>Hello, @context.User.Identity.Name!</text>
            <a href="/auth/signout">Log out</a>
        </Authorized>
        <NotAuthorized>
            <a href="/auth/signin">Log in</a>
        </NotAuthorized>
    </AuthorizeView>

@code {
    [Parameter]
    public string eventId { get; set; }

    public bool IsNeedPassword = false;

    protected override void OnInitialized()
    {

        base.OnInitialized();

    }

    protected override async Task OnInitializedAsync()
    {
        if (!Regex.IsMatch(eventId, @"^[0-9a-fA-F]{24}$"))
        {
            NavManager.NavigateTo("/");
        }
        var getResult = await Client.GetAsync($"api/Event/{eventId}");
        if (getResult.StatusCode == HttpStatusCode.Unauthorized)
        {
            // Need password
            IsNeedPassword = true;
        }
        else if (getResult.IsSuccessStatusCode)
        {
            // Show Event
        }
        
        await base.OnInitializedAsync();
    }

    [Inject]
    protected NavigationManager NavManager { get; set; }

    [CascadingParameter]
    private IIdentity User { get; set; }
}
